%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                 MICROSERVICE                                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\n{1}{Microservice architektura}

Při vývoji softwaru je možné aplikovat různé architektury a návrhové vzory. Za základní a vysoce rozšířenou architekturu lze považovat monolitickou architekturu. Aplikace využívající monolitickou architekturu sestávají z jedné kódové báze v níž se spojuje řešení veškeré doménové problematiky. Jsou založeny na principu, že celá aplikace je spuštěna jako jeden proces. Obecně obsahují určitou formu logického členění, například na jednotlivé doménové moduly nebo služby, které seskupují související části aplikace. \cite{Richardson2018} 

TODO: Obrázek monolitické architektury

Monolitická architektura je jednoduchá na vývoj, nasazení a testování. Při správném návrhu může poskytovat i jednoduchou možnost škálování, kdy aplikace funguje ve více identických instancích. \cite{Richardson2018} Jelikož i při logickém oddělení funkcionality je celá aplikace spjata pevnými vazbami, jakýkoliv zásah do jedné části aplikace může mít nepředvídatelné důsledky na ostatní části. Jednotná kódová báze zase může představovat limitující faktor pro rychlost vývoje, automatizace testovaní a nasazování. Samotné škálování může být vysoce neefiktivní a limitující, pokud je potřeba škálovat pouze určité části aplikace. \cite{Richardson2018}

Fundamentálně opačná je architektura microservice. Ta je založena na principu rozdělení aplikace do samostatných služeb. Každá z těchto služeb je zodpovědná za určitou část funkcionality aplikace. Služby jsou navzájem nezávislé a komunikují mezi sebou pomocí definovaných rozhraní. Tím je zajištěno, že každá služba může být vyvíjena, testována, nasazována a škálována nezávisle na ostatních. Tato architektura umožňuje vývojářům pracovat na menších a jednodušších částech aplikace, což zvyšuje produktivitu a umožňuje rychlejší iterace. Díky nezávislosti služeb je také možné dosáhnout vyšší odolnosti a škálovatelnosti aplikace. \cite{Richardson2018}

TODO: Obrázek microservice architektury

\n{2}{Historie}

Původ microservice architektury nelze přesně definovat, důležitý moment však nastal v roce 2011, kdy Martin Fowler publikoval článek \textit{Microservices} ve svém blogu spolu s Jamesem Lewisem. \cite{fowlerblog} V tomto článku je popsán způsob jakým lze tuto architekturu využít, její výhody a nevýhody. Dalším momentem, kdy microservice architektura nabyla popularity, bylo vydání knihy \textit{Building Microservices} od Sama Newmana v roce 2015. Tato kniha popisuje způsob, jakým je možné využít microservice architekturu v praxi.

Opravdový přelom přišel postupně, nástupem a popularizací virtualizace a kontejnerizace v průběhu let 2013 až 2015. Tímto bylo umožněno vytvářet a spouštět mikroslužby v izolovaných prostředích. Tímto bylo umožněno vytvářet mikroslužby, které jsou nezávislé na operačním systému a hardwaru, na kterém jsou spouštěny. Nejdůležitější v tomto ohledu je nepochybně projekt Docker, který byl vydán v roce 2013. \cite{dockerdocs} Díky Dockeru bylo možno jednoduše definovat, vytvářet a spouštět kontejnerizované aplikace. 

\n{2}{Základní principy}

Microservice ahitektura stojí na několika základních principech. Tyto principy nejsou jen teoretické, mají přímý dopad na to, jak jsou služby vyvíjeny, nasazovány a udržovány. Jejich dodržení je klíčové k úspěšné implementaci architektury. \cite{Richardson2018}

\begin{itemize}
    \item \textbf{Decentralizace} - Definuje, že každá služba zodpovídá za určitou část funkcionality aplikace. Služby jsou navzájem nezávislé a komunikují mezi sebou pomocí po síti pomocí deklarovaných rozhraní. Každá služba je samostatně nasaditelná a zodpovídá za svá data. \cite{Gammelgaard2021} Tím je zajištěno, že každá služba může být vyvíjena, nasazována a škálována nezávisle na ostatních.
    \item \textbf{Odolnost} - Odolnost nebo také robustnost microservice architektury je definována schopností systému zůstat v provozu i přes výskyt chyb v jeho dílčích částech. To znamená, že pokud jedna služba selže, zbytek systému může pokračovat v provozu. Toho je dosaženo použitím specifických vzorů. \emph{Circuit Breaker} představuje jeden z těchto vzorů. Zajišťuje aby služby mimo provoz nebyly zbytečně zatíženy požadavky. Komunikace v tomto vzoru probíhá za pomocí stavového automatu, jenž za splnění určitých kritérií (například konkrétního počtu neúspěšných požadavků) se sepne a na určitou dobu přestane zasílat další požadavky. \cite{Gammelgaard2021}
    TODO: Obrázek Circuit Breaker
    \item \textbf{Kontejnerizace} - Kontejnerizace představuje proces zabalení služby spolu s veškerými závislostmi jako je OS, prostředí a konfigurace. Kontejner tvoří základní spustitelnou jednotku microservice architektury. Je založen na minimalistickém obrazu OS k němuž jsou dodány potřebné nástroje, knihovny a samotná služba. Takto vytvořený kontejner je virtualizován, tedy spuštěn jako samostatný virtuální OS v rámci hostitelského OS. \cite{dockerdocs} Moderní metody kontejnerizace zakládájí na technologii Docker, jenž poskytuje ekosystém pro kompletní proces tvorby, sdílení a nasazení kontejnerů. Hlavní výhodou kontejnerizace je umožňění běhu aplikace ve vybraném prostředí s vybranou konfigurací při co nejmenší režii.
    \item \textbf{Orchestrace} - Rozšířováním počtu služeb respektive kontejnerů se jejich správa stává složitou. Nástroje pro orchestraci pomáhají automatizovat nasazení, škálování a správu kontejnerů. Mezi oblíbené orchestrační nástroje patří Kubernetes, Docker Swarm a Mesos. Mezi jejich úlohy patří řešit problémy jako vyhledávání služeb, vyvažování zátěže, přidělování prostředků a škálování na základě zátěže.
    \item \textbf{Škálování} - Architektura microservice zvyšuje škálovatelnost aplikace a umožňuje ji provádět jen v rámci konkrétní části, na úrovni dílčích služeb. Škálování probíhá typicky vytvoření množství několika instancí stejné služby a nastavením služby v roli tzv. \emph{Load Balancer}, jenž distribuuje požadavky na jednotlivé služby podle definovaných. Typicky se cíl požadavku určuje dle hashe IP adresy požadavku nebo na základě váhy či doby odpovědi instance. Pomocí těchto technik je v aplikaci dosaženo zlepšení schopnosti zvládat velké objemy požadavků za využití co nejmenšího množství dodatečných prostředků. \cite{Gammelgaard2021}
\end{itemize}

\n{2}{Komponenty}

Architektura mikroslužeb rozkládá aplikace do menších, oddělených služeb, z nichž každá plní samostatnou funkci. Pro efektivní správu těchto služeb, zejména v distribuovaném prostředí, se používá několik základních komponent. Tato část se zabývá klíčovými architektonickými komponentami, které usnadňují robustní provoz, komunikaci a škálovatelnost mikroslužeb. \cite{Williams2023}

\n{3}{Obecné komponenty}

\begin{itemize}
    \item \textbf{API Gateway} - Brána, která slouží jako vstupní bod pro komunikaci s mikroslužbami. Zajišťuje směrování požadavků, autentizaci, autorizaci, zabezpečení a další funkce, které jsou společné pro všechny služby. API Gateway může také poskytovat další funkce, jako jsou cachování, transformace zpráv a řízení toku dat. Tím zjednodušuje a centralizuje správu komunikace mezi klienty a mikroslužbami.
    \item \textbf{Service Discovery} - Mechanismus, který umožňuje mikroslužbám dynamicky najít a komunikovat s ostatními službami v systému. To je důležité pro dynamické škálování, nasazování a správu služeb. Service Discovery může být implementován pomocí centrálního registru služeb nebo distribuovaného protokolu.
    \item \textbf{Load Balancer} - Služba rozděluje provoz mezi několik instancí stejné služby, aby se zajistila rovnoměrná zátěž a zvýšila odolnost proti chybám. Load Balancer může být implementován jako hardwareové zařízení nebo softwarová služba, která poskytuje rozhraní pro konfiguraci a správu zátěže.
\end{itemize}

\n{3}{Komunikační systémy}

Mikroslužby spolu komunikují skrze rozhraní prostřednictvím vybraných protokolů, nástrojů a vzorů. Mezi nejčastěji využívané patří:

\begin{itemize}
    \item \textbf{REpresentational State Transfer} (dále REST) - Představuje vysoce rozšířenou možnost komunikace mezi mikroslužbami. Využívají se při ní standardní metody protokolu Hypertext Transfer Protocol (dále HTTP) k provádění operací na rozhraní identifikovaným prostřednictvím adresy URL. Díky bezstavové povaze je rozhraní REST vysoce škálovatelné a vhodné pro veřejně přístupné služby. Má širokou podporu na různých platformách a v různých jazycích, což pomáhá zajistit interoperabilitu v rozmanitém ekosystému mikroslužeb.
    \item \textbf{Remote Procedure Call} (dále RPC) - Komunikační metoda používaná v distribuovaných systémech, včetně mikroslužeb, kdy program způsobí, že se procedura spustí v jiném adresním prostoru (obvykle na jiné virtualizované ve sdílené síti). Tato technika abstrahuje složitost síťové komunikace do jednoduchosti volání lokální funkce nebo metody. Mezi běžné implementace RPC patří generic RPC (dále gRPC), Thrift anebo Apache Avro. \cite{Sazanavets2022}
    \item \textbf{Message Broker} - Jedná se o komunikační vzor kdy broker - prostředník, spravuje asynchronní komunikaci mezi mikroslužbami pomocí front zpráv. Tato metoda odděluje mikroslužby tím, že jim umožňuje publikovat zprávy do fronty, aniž by znaly podrobnosti o tom, které služby je budou spotřebovávat. Mezi běžné zprostředkovatele zpráv patří RabbitMQ, Apache Kafka a AWS SQS. Tato komunikační architektura zvyšuje odolnost proti chybám, protože zprostředkovatel zpráv může zajistit, že zprávy nebudou ztraceny při přenosu, i když je spotřebitelská služba dočasně nedostupná. 
\end{itemize}

\n{3}{Databáze}

V microservice architektuře si každá služba obvykle spravuje vlastní databázi podle vzoru \emph{Database per Service}. Tato izolace umožňuje službám být volně provázané a nezávisle nasaditelné, přičemž každé databázové schéma je přizpůsobeno konkrétním potřebám služby. V závislosti na případu použití mohou služby používat různé typy databází. Structured Query Language (dále SQL) pro transakční data vyžadující silnou konzistenci a vlastnosti Atomocity Consistency Isolation Duratibility (dále ACID). Nebo Not only SQL (dále NoSQL) pro flexibilnější možnosti ukládání dat, které nabývají velkých objemů, nejsou definovány schématy nebo mají specifickou vazbu například na čas. 

Různorodost databázových technologií přináší výzvy, jako je jednotný přístup k datovým zdrojům. Ten je řešen pomocí vzoru \emph{Repository}. Tento vzor využívá vytvoření obecného rozhraní, které definuje standartní operace pro přístup k datům. Pro každou databázovou technologii a její specifické rozhraní je vytvořena implementace tohoto rozhraní. Díky tomu služby mohou pracovat stejným způsobem nezávisle na využitou databázovou technologii.
TODO: Obrázek Repository

Další častou problematikou je udržování konzistence dat v transakcích probíhajících napříč více službami. K řešení se využívájí specifické vzory, jako je například \emph{Saga}. Saga je vzor, který řeší distribuované transakce formou lokálních transakcí v jednotlivých službách. Pokud při některé z dílčích transakcí dojde k chybě, je vyvolaná série kompenzačních transakcí, jenž vrátí systém do původního stavu. Řízení událostí může být vedeno formou choreografie, kdy jednotlivé služby zodpovídají za publikování událostí spouštějících následující transakci. Alternativně může být využitý orchestrátor, který distribuovanou transakci řídí. \cite{richardsonsaga}
TODO: Obrázek Saga

\n{3}{Bezpečnost}

Bezpečnost v architektuře microservice je velmi důležitá, protože distribuovaná povaha těchto systémů přináší mnoho zranitelných míst. Bezpečnostní prvky se zaměřují na ochranu dat při přenosu i v klidovém stavu a zajišťují, že k službám a datům mají přístup pouze oprávněné subjekty. Mezi klíčové strategie patří implementace API Gateway s vestavěnými bezpečnostními prvky, jako je ověřování, autorizace a terminace SSL. Zásadní význam mají systémy správy identit a přístupu (Identity and Access Management, dále IAM), často integrované s tokeny Open Authorization (dále OAuth) a JWT pro správu identit uživatelů a řízení přístupu na základě definovaných zásad. Zajištění šifrované komunikace mezi službami pomocí protokolů, jako je Transport Layer Security (dále TLS), může navíc chránit před odposlechem a manipulací. Zásadní jsou také účinné strategie logování, auditování a monitorování, které poskytují možnost odhalovat bezpečnostní hrozby, reagovat na ně a zmírňovat je v reálném čase. Každá z těchto složek hraje klíčovou roli při vytváření bezpečného ekosystému služeb a umožňuje robustní obranné mechanismy proti interním i externím bezpečnostním rizikům.

\n{2}{Testování}

Testování mikroslužeb je klíčové pro zajištění kvality a spolehlivosti systému. Mikroslužby lze testovat na několika následujících úrovních:

\begin{itemize}
    \item \textbf{Jednotkové testy} - Testují jednotlivé komponenty služby, jako jsou třídy, metody a funkce. Cílem je ověřit, že jednotlivé části fungují správně a splňují požadavky.
    \item \textbf{Integrační testy} - Testují komunikaci mezi službami a ověřují, že služby spolupracují správně. Zjišťují, jestli služby komunikují správně a zda jsou data přenášena a zpracovávána správně.
    \item \textbf{End-to-end testy} - Testují celý systém z pohledu uživatele. Cílem je ověřit, že systém funguje správně a splňuje požadavky uživatele.
    \item \textbf{Smoke testy} - Testují základní funkce systému, aby se ověřilo, že je systém správně sestaven, dokáže se spustit a provést základní operace.
    \item \textbf{Load testy} - Testují výkonnost systému za zátěžových podmínek. Cílem je ověřit, že systém je schopen zvládnout požadavky uživatelů a udržet výkon při zátěži.
    \item \textbf{Penetrační testy} - Testují bezpečnost systému a identifikují potenciální bezpečnostní chyby. Cílem je odhalit slabá místa v systému a zlepšit jeho odolnost proti útokům.
\end{itemize}

Automatizované testování je klíčové pro rychlé a spolehlivé nasazení. Pomáhá odhalit chyby a problémy v raných fázích vývoje a minimalizuje riziko selhání v produkci. Testování microservice architektury je však složitější než testování monolitických aplikací, protože služby jsou distribuované a navzájem závislé. Automatizace pomáhá zjednodušit komplexní testovací strategie a zajišťuje, že jednotlivé části aplikace jsou spolehlivé. \cite{Newman2015}

\n{2}{Výhody a nevýhody}

Mezi hlavní výhody microservice architekture lze zařadit:

\begin{itemize}

\item \textbf{Přizpůsobitelnost} - Mikroslužby umožňují rychlé, modulární a spolehlivé poskytování rozsáhlých a komplexních aplikací. Týmy mohou aktualizovat určité oblasti aplikace, aniž by to mělo dopad na celý systém, což umožňuje rychlejší iterace.

\item \textbf{Škálovatelnost} - Služby lze škálovat nezávisle, což umožňuje přesnější přidělování zdrojů na základě aktuálního stavu systému. Tím je řešena problematika proměnlivého zatížení aplikace.

\item \textbf{Odolnost} - Decentralizovaná povaha služeb pomáhá izolovat selhání na jedinou službu nebo malou skupinu služeb, čímž zabraňuje selhání celé aplikace.

\item \textbf{Technologická rozmanitost} - Týmy si mohou vybrat nejlepší nástroj pro danou práci a podle potřeby používat různé programovací jazyky, databáze nebo jiné nástroje pro různé služby, což vede k optimalizovanějším řešením.

\item \textbf{Flexibilita nasazení} - Mikroslužby lze nasazovat nezávisle, což je ideální pro vzory CI/CD. Umožňuje průběžné aktualizace při minimalizaci prodlevy a minimalizaci rizika.

\item \textbf{Modularita} - Microservice architektura zvyšuje modularitu, což usnadňuje vývoj, testování a údržbu aplikací. Týmy se mohou zaměřit na konkrétní doménovou logiku, což zvyšuje produktivitu a kvalitu. Rovněž umožňuje geograficky dislokované nasazení.

\end{itemize}

Zatímco mezi nevýhody patří:

\begin{itemize}

\item \textbf{Komplexnost} - Správa více služeb na rozdíl od monolitické aplikace přináší složitost při nasazování, monitorování a řízení komunikace mezi službami.

\item \textbf{Správa dat} - Konzistence dat mezi službami může být náročná, zejména pokud si každá mikroslužba spravuje vlastní databázi. Implementace transakcí napříč rozhraními vyžaduje pečlivou koordinaci.

\item \textbf{Zpoždění sítě} - Komunikace mezi službami po síti přináší zpoždění, které může ovlivnit výkonnost aplikace. Ke zmírnění tohoto jevu jsou nutné efektivní komunikační protokoly a vzory.

\item \textbf{Provozní režie} - S počtem služeb roste potřeba orchestrace, monitorování, protokolování a dalších provozních záležitostí. To vyžaduje další nástroje a odborné znalosti.

\item \textbf{Složitost vývoje a testování} - Mikroslužby sice zvyšují flexibilitu vývoje, ale také komplikují testování, zejména pokud jde o testování \emph{end-to-end}, které zahrnuje více služeb.

\item \textbf{Integrace služeb} - Zajištění bezproblémové spolupráce služeb vyžaduje robustní správu API, řízení verzí a strategie zpětné kompatibility.

\end{itemize}

\n{2}{Nasazení založené na mikroslužbách}

Efektivní nasazení mikroslužeb je klíčové pro využití jejich potenciálních výhod, jako je škálovatelnost, flexibilita a odolnost. Tato část se zabývá různými strategiemi nasazení, které jsou pro mikroslužby obzvláště vhodné, zejména v prostředí cloud-native. Tyto strategie zajišťují, že mikroslužby lze efektivně spravovat a škálovat, dynamicky reagovat na změny zatížení a minimalizovat prostoje. \cite{Williams2023}

\n{3}{Strategie}

Existuje několik strategií nasazení, které jsou v microservice architektuře aplikovatelné:

\begin{itemize}
    \item \textbf{Jedna služba na hostitele} - Strategie zahrnuje nasazení každé služby na vlastní server, ať už virtuální, nebo fyzický. Tento přístup zjednodušuje ladění a izolaci služeb, ale může vést k nedostatečnému využití zdrojů a vyšším nákladům.
    \item \textbf{Více služeb na jednoho hostitele} - Nasazení více služeb na jednom hostiteli maximalizuje využití zdrojů a snižuje náklady. Vyžaduje však pečlivou správu, aby nedocházelo ke konfliktům a aby se služby vzájemně nerušily.
    \item \textbf{Instance služby na kontejner} - Moderní nasazení mikroslužeb často používají kontejnery (například Docker) pro umístění jednotlivých služeb. Kontejnery poskytují odlehčené, konzistentní prostředí pro každou službu, zjednodušují nasazení a škálování v různých prostředích a zajišťují, že každá služba má splněny své závislosti bez konfliktů.
\end{itemize}

\n{3}{Cloud-native nasazení}

Microservice architektura je obzvláště vhodná pro nativní cloudová prostředí, která podporují jejich dynamickou povahu. Příklady strategií cloud-native nasazení zahrnují:

\begin{itemize}
    \item \textbf{Kontejnery a orchestrace} - Nástroje jako například Kubernetes orchestrují kontejnerové služby a řídí jejich životní cyklus od nasazení až po ukončení. Kubernetes se stará o škálování, vyrovnávání zátěže a obnovu. Umožňuje také deklarativní konfiguraci a  definici infrastruktury formou kódu, což zjednodušuje správu a automatizaci nasazení. Využití kontejnerů a orchestrace umožňuje rychlé a spolehlivé nasazení mikroslužeb při maximální kontrole nad prostředím.
    \item \textbf{Mikroslužby na platformě jako služba} - Platform as a Service (dále PaaS) je typ nasazení poskytovující prostředí, kde lze mikroslužby snadno nasadit, škálovat a spravovat bez nutnosti starat se o základní infrastrukturu. Poskytovatel cloudu je zodpovědný za provoz a správu platformy, což uživatelům umožňuje soustředit se na vývoj aplikací.
    \item \textbf{Serverless} - Bezserverové výpočetní modely umožňují nasazení mikroslužeb jako funkcí (Function as a Service, dále FaaS), které se spouštějí v reakci na události. Poskytovatel cloudu spravuje prostředí, v němž jsou nasazeny a dodává rozhraní pro jejich konfiguraci. Tento model je prezentován jako vysoce škálovatelný a nákladově efektivní, protože zdroje jsou spotřebovávány pouze během provádění funkcí. \cite{Garrison2017}
\end{itemize}