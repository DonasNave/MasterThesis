%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                    .NET                                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\n{1}{Platforma .NET}

Platforma .NET od společnosti Microsoft představuje sadu nástrojů k vývoji aplikací v podporovaných jazycích. Tato platforma je multiplatformní a umožňuje vývoj aplikací pro operační systémy jako Windows, Linux, macOS ale i pro mobilní platformy. Vývojáři mohou využívat nástroje pro vývoj webových aplikací, desktopových aplikací, mobilních aplikací a dalších. Platforma .NET je postavena na dvou hlavních nástrojích. Prvním z nich je \textit{Common Language Runtime} (dále jen CLR), runtime prostředí zodpovídající za běh aplikací. Druhým nástrojem je \textit{dotnet CLI}, konzolový nástroj-rozhraní, zodpovědné za interakci s dílčími nástroji v platformě. \cite{Richter2012}

\n{2}{Historie}

Využití runtime prostředí, respektive v originální podobě virtuálního stroje, má historický původ. V dřívějších dobách byly programátoři limitování nutností kompilace kódu do nativní reprezentace přímo pro architekturu systému. Kód vytvořen pro jednu konkrétní architekturu se zpravidla neobešel bez modifikací, pokud měl fungovat i na odlišné architektuře.

V průběhu 90. let 20. století představila společnost Sun-Microsystems virtuální stroj Java Virtual Machine (JVM). Jedná se o komponentu runtime prostředí Javy, která zprostředkovává spuštění specifického kódu, správu paměti, vytváření tříd a typů a další. Kompilací Javy do tzv. Bytecode (Intermediate Language, zkráceně IL), tedy provedením mezikroku v procesu transformace zdrojového kódu do strojového kódu, je získána reprezentace programu, jenž běží na každém zařízení s implementovaným JVM. V rámci JVM dochází k finálnímu kroku a to interpretaci (JIT kompilaci) Bytecode do cílové architektury systému. 

Microsoft v reakci na JVM vydal v roce 2000 první .NET Framework, který umožňoval spouštět kód v jazyce C\# na operačním systému Windows. Cílem prvních verzí .NET Framework nebylo primárně umožnit vývoj pro různé zařízení a operační systémy, ale zprostředkovat lepší nástroje pro vývoj aplikací. KV roce 2014 byla vydána první multiplatformní verze .NETu. Byl vydán .NET Core, který umožňoval spouštět kód v jazyce C\# na operačních systémech Windows, Linux a macOS. \cite{Richter2012}

\n{2}{Architektura}

Platforma .NET je postavena na několika klíčových komponentách, které zajišťují běh aplikací a poskytují nástroje pro vývoj aplikací. Mezi nejdůležitější komponenty patří:


\begin{itemize}
    \item \textbf{CLR} - CLR je základním kamenem frameworku .NET a poskytuje runtime prostředí pro spouštění aplikací .NET. Překládá IL do strojového kódu, spravuje alokaci paměti a garbage collection, zajišťuje zpracování výjimek (exceptions). CLR také kontroluje datové typy, interoperabilitu a zprostředkovává služby nezbytné pro spouštění nejrůznějších aplikací .NET.
    \item \textbf{.NET CLI} (konzolové rozhraní) - Všestranný nástroj pro vývoj, kompilaci a nasazení aplikací .NET prostřednictvím rozhraní příkazové řádky. Podporuje širokou škálu operací, od vytváření projektů a správy závislostí až po testování a publikování aplikací. Prostředí .NET CLI je multiplatformní a umožňuje sjednocení rozhraní uživatelských nástrojů pro vývoj aplikací .NET.
    \item \textbf{MSBuild} - Engine používaný v platformě .NET, který umožňuje sestavovat aplikace a vytvářet balíčky pro nasazení. Tento nástroj používá k organizaci a řízení procesu sestavení projektový souboru založený na XML. Tím je zajištěna kontrola nad kompilací a průběhem sestavení. V rámci MSBuild lze doplnit vlastní úlohy a cíle, což poskytuje flexibilitu sestavení pro komplexní procesy ve velkých projektech.
    \item \textbf{.NET SDK nástroje} - Soubor nástrojů a knihoven podporujících vývoj, debugging a testování aplikací .NET. Zahrnují různé CLI a GUI nástroje, které pomáhají vývojářům spravovat práci s kódem, optimalizovat výkon a zajistit kvalitní výstup programu v platformě .NET.
    \item \textbf{Roslyn} - Roslyn je sada kompilátorů platformy .NET, která poskytuje bohaté API pro analýzu kódu. Umožňuje vývojářům používat implementace kompilátorů jazyka C\# a Visual Basic jako služby. Roslyn zlepšuje výkonnost vývojářů poskytnutím funkcí jako je refaktoring, generování kódu a sémantická analýza.
    \item \textbf{NuGet} - Správce balíčků pro platformu .NET. dodává standardizovanou metodu správy externích knihoven, na nichž závisí aplikace v .NET. Zjednodušuje proces inkorporace knihoven, systémových i třetích stran, do projektu. Rovněž spravuje závislosti, čímž zajišťuje, že projekty zůstávajá aktuální a kompatibilní. Tento nástroj je téměř nezbytný pro vývoj na platformě .NET, neboť umožňuje modulární vývoj softwaru.
\end{itemize}

TODO: Přidat obrázek architektury nástrojů platformy .NET

\n{2}{Frameworky a technologie}

Platforma .NET poskytuje mnoho frameworků a technologií pro vývoj aplikací. Jednotlivé frameworky plní různé role a poskytují různé úrovně funkcionality pro vývoj aplikací. Z hlediska struktury a účelu lze frameworky kategorizovat následujícím způsobem.

\n{3}{Foundtation frameworky}

Jedná se o komplexní frameworky poskytující základní funkcionalitu pro vývoj aplikací. Představují základní stavební kameny a fundamentální sadu nástrojů platformy .NET.

\begin{itemize}
    \item \textbf{.NET} - Hlavní framework platformy .NET. Poskytuje sadu nástrojů a knihoven pro vývoj aplikací v jazyce C\# a .NET. .NET obsahuje sadu tříd a metod, které mohou být použity při vývoji aplikací. .NET poskytuje sadu nástrojů pro vývoj aplikací, včetně nástrojů pro sestavení, testování a publikaci. .NET umožňuje vývoj aplikací pro platformy Windows, Linux a macOS pomocí jednoho kódu. Vývojáři mohou vytvářet aplikace pro různé platformy pomocí jednoho kódu a sdílet kód mezi různými platformami.
    \item \textbf{Mono} - Open-source implementace platformy .NET. Poskytuje sadu nástrojů a knihoven pro vývoj aplikací v jazyce C\# a .NET. Mono umožňuje vývoj aplikací pro platformy Windows, Linux a macOS pomocí jednoho kódu. Vývojáři mohou vytvářet aplikace pro různé platformy pomocí jednoho kódu a sdílet kód mezi různými platformami. Mono je dostupný jako open-source projekt a je vyvíjen komunitou vývojářů. Mono poskytuje sadu nástrojů pro vývoj aplikací, včetně nástrojů pro sestavení, testování a publikaci. Mono umožňuje vývoj aplikací pro platformy Windows, Linux a macOS pomocí jednoho kódu. Vývojáři mohou vytvářet aplikace pro různé platformy pomocí jednoho kódu a sdílet kód mezi různými platformami.
\end{itemize}

\n{3}{Specializované frameworky}

Představují sady nástrojů a knihoven zaměřených konkrétním oblastem vývoje aplikací a zjednodušují tvorbu cílených typů aplikací. Zaměřují se na konkrétní potřeby vývoje, jako jsou webové, mobilní nebo desktopové aplikace, a umožňují vývojářům efektivně implementovat funkcionalitu optimalizovanou pro konkrétní platformu. 

\begin{itemize}
    \item \textbf{ASP.NET} - Robustní framework pro vytváření webových aplikací a služeb. Je součástí ekosystému .NET navržený tak, aby umožňoval vývoj vysoce výkonných, dynamických webových stránek, RESTful API a webových aplikací v reálném čase. ASP.NET podporuje jak webové formuláře pro rychlý vývojový model prostřednictvím rozhraní přetahování a serverových ovládacích prvků, tak architekturu MVC (Model-View-Controller), která podporuje čisté oddělení problémů, testovatelnost a výkonné směrování URL pro SEO. -přátelské webové aplikace. S uvedením ASP.NET Core bylo přepracováno pro cloudovou škálovatelnost, vývoj napříč platformami a vysoký výkon, takže je ideální pro vývoj moderních webových aplikací, které lze spustit na Linuxu, Windows a macOS. ASP.NET Core také představuje Blazor, který umožňuje vývojářům používat C\# při vývoji webu, což dále zvyšuje všestrannost ekosystému. Vývojářům, kteří chtějí využít .NET pro vývoj webu, poskytuje ASP.NET komplexní a flexibilní sadu nástrojů pro vytváření všeho od malých webů po složité webové platformy.
    \item \textbf{MAUI} - Moderní specializovaný framework pro vývoj aplikací napříč platformami v rámci ekosystému .NET. Umožňuje vývojářům vytvářet aplikace pro Android, iOS, macOS a Windows z jediné kódové základny, která zahrnuje to nejlepší z Xamarin.Forms a zároveň rozšiřuje jeho možnosti na desktopové aplikace. .NET MAUI zjednodušuje vývojový proces tím, že poskytuje jednotnou sadu rozhraní API pro vývoj uživatelského rozhraní na všech platformách s možností přístupu k funkcím specifickým pro platformu v případě potřeby. Podporuje moderní vývojové vzory a nástroje, včetně MVVM, datové vazby a asynchronního programování, což usnadňuje vytváření sofistikovaných a citlivých aplikací. Vývojářům, kteří chtějí využít sílu .NET napříč mobilními a desktopovými platformami, nabízí .NET MAUI komplexní a moderní sadu nástrojů navrženou tak, aby vyhovovala dnešním vývojovým výzvám a zároveň zajistila přenositelnost a udržovatelnost kódu.
    Předchůdcem MAUI je framework Xamarin, který sloužil pro vytváření mobilních aplikací na platformě .NET.
    \item \textbf{Blazor} - Specializovaný framework v rámci ekosystému .NET, který zprostředkovává vývojářům tvorbu interaktivních webových uživatelských rozhraní pomocí C\# namísto JavaScriptu. Blazor může běžet na serveru (Blazor Server), kde zpracovává interakce s uživatelským rozhraním přes připojení SignalR, nebo v prohlížeči pomocí WebAssembly (Blazor WebAssembly) ke spouštění kódu C\# přímo ve webovém prohlížeči vedle tradičních webových technologií, jako jsou HTML a CSS. Tento přístup umožňuje vývojářům využít znalosti .NET pro komplexní vývoj webových aplikací a vytvářet bohaté webové aplikace na straně klienta s .NET spuštěným v prohlížeči. Architektura Blazor je založená na komponentách a usnadňuje jejich opětovné použití pro uživatelského rozhraní. Podporuje modulární vývojový přístup. Poskytuje možnost vyvíjet webové aplikace a zůstat v ekosystému .NET.
\end{itemize}

\n{3}{Knihovny}

Knihovny představují soubor funkcí a tříd, které mohou být použity při vývoji ve více aplikacích. Typicky představují logicky oddělenou a obecnou část funkcionality aplikace. Umožňují distribuovat běžnou funkcionalitu napříč různými projekty a . Knihovny v .NET mohou být tvořeny binárnimi DLL soubory (Dynamic Link Libraries) nebo organizované jako samostatný projekt v rámci solution. Distribuce knihoven je obecně prováděna jejich zabalením pomocí nástroje NuGet a sdíleny přes internetová úložiště.

Běžnou praxí tvůrce platformy, programovacího jazyka nebo frameworku je poskytnutí sad knihoven, které usnadňují vývoj aplikací. Zároveň tyto knihovny zpravidla implementují nejběžnější funkcionality, které mohou programátoři vyžadovat. Typicky se jedná o přístup k souborovému systému, síti, databázím, grafickému rozhraní a další.

Následující seznam obsahuje některé z nejběžněji používaných knihoven v .NET:

\begin{itemize}
    \item \textbf{System} - Tato základní knihovna obsahuje třídy, typy a rozhraní, které umožňují a podporují širokou škálu operací na úrovni systému, jako jsou vstupy a výstupy (IO), vlákna, kolekce, diagnostika a další. Je nezbytná prakticky pro každou aplikaci .NET.
    \item \textbf{System.IO} - Dodáva funkcionalitu čtení z datových proudů, souborů a zápis do nich a práci se souborovým systémem.
    \item \textbf{System.Net} - Obsahuje třídy a abstrakce pro síťovou komunikaci, včetně HTTP, socketů TCP/IP a SMTP pro elektronickou poštu.
    \item \textbf{System.Data} - Poskytuje přístup k datovým zdrojům, jako jsou databáze nebo XML soubory, a obsahuje ADO.NET pro přístup k datům ze serveru SQL Server a dalších databází.
    \item \textbf{System.Collections} - Rozhraní a třídy, které definují různé kolekce objektů, jako jsou seznamy, fronty, bitová pole, hašovací tabulky a slovníky.
    \item \textbf{System.Linq} - Zaštiťuje dotazování nad kolekcemi objektů pomocí LINQ (Language Integrated Query).
    \item \textbf{System.Threading} - Zprostředkovává správu vláken, synchronizační primitiva nebo například thread pool. Umožňuje vyvíjet paralelizované aplikace.
    \item \textbf{System.Security} - Spravuje ověřování, autorizaci a šifrování, a je základem pro vývoj bezpečných aplikací.
\end{itemize}

Kromě knihoven poskytovaných společností Microsoft existuje mnoho knihoven třetích stran. Za vývojem těchto knihoven mohou stát vývojařské komunity nebo být vydány velkými společnostmi. Běžně tyto knihovny navazují na sadu funkcí poskytovaných Microsoftem a rozšiřují je o další novou funkcionalitu. Mezi nejznámější knihovny třetích stran v .NET patří Dapper, AutoMapper, Newtonsoft.Json a další.

\n{2}{Nástroje .NET}

Platforma .NET zprostředkovává širokou sadu nástrojů za účelem tvorby, sestavení a spuštění aplikace. Mezi nejdůležitější lze zařadit následující:

\n{3}{IDE}

Neméně důležitým prvkem vývoje aplikací je vývojové prostředí (IDE). I když není povinné, pro spoustu vývojářů je jeho použití neodmyslitené. IDE je nástroj, který zprostředkovává vývoj aplikací, správu projektů, debuggování a další. IDE poskytuje uživatelské rozhraní, které umožňuje vývojářům vytvářet, upravovat a testovat kód. IDE poskytuje také nástroje pro správu projektů, jako jsou sestavení, testování a publikace. Umožňuje provádět různorodé operace na aplikací, jako je refaktorování kódu, hledání chyb a ladění.

Jedním z nejpoužívanějších IDE je Visual Studio, vydávané společností Microsoft. Visual Studio poskytuje prvotřídní podporu pro vývoj na platformě .NET. Mezi další populární IDE patří Visual Studio Code, JetBrains Rider a další.


\n{3}{Balíčky}

Pro jednoduchou distribuci knihoven, jak systémových tak třetích stran, je využíván balíčkovací manager NuGet. Projekt, jenž má být distribuován je buďto opatřen atributem \emph{<PackageOnBuild>} a sestaven nebo je využito příkazu \emph{dotnet pack}. 

Takto vytvořené balíčky lze distribuovat např. přes NuGet.org, což je veřejný repozitář knihoven, který je dostupný pro všechny vývojáře. Možná je také implementace vlastních řešení. Distribuované knihovny jsou jednoduše přidatelné do projektu a umožňují snadnou správu závislostí.

\n{3}{Dokumentace}

Dokumentace je důležitou součástí vývoje aplikací. Poskytuje informace o tom, jak používat nástroje a technologie, které jsou součástí platformy .NET. Dokumentace obsahuje informace o API, knihovnách, nástrojích a dalších součástech platformy .NET. Dokumentace je dostupná online na oficiálních webových stránkách platformy .NET a obsahuje podrobné informace o mnoha aspektech vývoje aplikací v .NET. Dotnet dokumentace je k nalezení na webu \url{https://docs.microsoft.com/en-us/dotnet/}.

\n{2}{Jazyky a struktura aplikace}

Základem aplikace je zdrojový kód, který je v případě platformy dotnet reprezentován nejčastěji jedním ze podporovaných jazyků, Mezi nejčastěji využívané patří VisualBasic (VB), C\# a F\#.

\n{3}{Jazyky}

\n{4}{C\#}

představuje všestranný, objektově orientovaný jazyk navržený tak, aby umožnil vývojářům vytvářet širokou škálu bezpečných a robustních aplikací, které běží na .NET Framework. Kombinuje sílu a flexibilitu C++ s jednoduchostí jazyka Visual Basic.

\n{4}{F\#}

je funkční jazyk, který také podporuje imperativní a objektově orientované programování. Primárně je vhodný pro vědecké aplikace a aplikace náročné na data. Zakládá na silném typování, umožňuje stručný, robustní a výkonný kód.

\n{4}{Visual Basic}

programovací jazyk vyvinutý společností Microsoft. VB, představený v roce 1991, byl navržen jako uživatelsky přívětivé programovací prostředí založené na jazyce BASIC; jeho drag-and-drop rozhraní umožňovalo snadné vytváření grafických uživatelských rozhraní (GUI). Tento přístup zpřístupnil programování širšímu okruhu uživatelů a kladl důraz na rychlý vývoj aplikací (RAD).

\n{3}{Aplikační struktura}

Základním stavebním prvkem aplikace v .NET je projektový soubor. Jedná se o XML soubor disponující příponou \emph{.csproj}. V rámci něj dochází ke konfiguraci a deklaraci, jak bude .NET CLI s projektem pracovat. Zároveň jsou zde definováný závislosti na další projekty a knihovny. Mezi základní charakteristiky běžně určené v projektovém souboru patří verze .NET, verze projektu/assembly, seznam závislostí, konfigurace pro buildování, testování a publikaci.

Pro tvorbu složitějších aplikací je možné využít více projektových souborů, které jsou následně propojeny. Tento způsob je využíván především v případě větších aplikací, které jsou rozděleny do více částí. Propojení a vazby mezi více projekty v aplikaci je definované pomocí tzv. solution souboru. Jedná se o kontejnerový soubor s příponou \emph{.sln}, jenž popisuje závislosti mezi projektovými soubory, konfigurace sestavení a nasazení a správu pomocných souborů.

Mezi další běžně používané známé konfigurační soubory patří následující:

\begin{itemize}
    \item \textbf{appsettings.json} - konfigurační soubor, který obsahuje nastavení aplikace
    \item \textbf{launchsettings.json} - konfigurační soubor, který obsahuje nastavení pro spuštění aplikace
    \item \textbf{Directory.Build.props} - konfigurační soubor, který obsahuje globální nastavení atributů pro všechny projekty v solution
    \item \textbf{Directory.Build.targets} - konfigurační soubor, který obsahuje globální nastavení cílů kompilace pro všechny projekty v solution
    \item \textbf{NuGet.config} - konfigurační soubor, který obsahuje nastavení pro balíčkovací manager NuGet
    

\end{itemize}

Dalším příkladem projektového souboru je \emph{.fsproj} pro F\# projekty, \emph{.vbproj} pro Visual Basic projekty a \emph{.nuspec} pro balíčkovací soubory NuGet. Speciálně pro IDE Visual Studio je využíván soubor \emph{.dcsproj}, který obsahuje nastavení pro spustění a debuggování aplikace spuštěné v Docker kontejneru. 

\n{2}{Kompilace zdrojového kódu}

Kompilace je proces transformace zdrojového kódu do jiné podoby. Kód je zpravidla kompilován do podoby bližší cílové architektuře, ať je touto architekturou OS, případně konkrétní HW, nebo runtime prostředí (virtuální stroj). V rámci platformy .NET jsou k dispozici 2 hlavní fundamentálně odlišné režimy kompilace zdrojového kódu: kompilace pro běhové prostředí (CLR) do tzv. \emph{assembly} a kompilace do nativního kódu přímo pro cílovou architekturu (Native AoT).

\n{3}{Cíle kompilace}

Cílem kompilace je převést zdrojový kód do podoby, kterou je možné spustit na cílovém zařízení. Platforma .NET podporuje zacílit na několik cílových zařízení, jako jsou desktopové počítače, mobilní zařízení nebo cloudové služby na základě použitých nástrojů a frameworků. Mezi podporované cíle patří:

\n{4}{PC}

Zacílení na platformy PC nabízí probíhá několika způsoby. Aplikace obvykle běží na CLR, kde je kód kompilován do jazyka IL a poté spouštěn prostřednictvím .NET runtime, přičemž je za běhu převeden na nativní kód. Pro situace, kdy .NET runtime není nebo nemůže být přítomen poskytuje .NET možnost kompilace Ahead-Of-Time (AOT) prostřednictvím nástrojů jako .NET Native.

\n{4}{Mobilní zařízení}

Pro mobilní vývoj poskytuje .NET MAUI (nebo také Xamarin), sadu nástrojů, které umožňují vývojářům psát nativní aplikace pro Android, iOS a Windows s jedinou sdílenou kódovou základnou .NET. Xamarin se integruje do sady Visual Studio a umožňuje vývojářům používat knihovny C\# a .NET k vytváření a spouštění mobilních aplikací. Tyto aplikace jsou kompilovány specificky pro každou platformu a mohou využívat nativní funkce zařízení.

\n{3}{Obecné postupy kompilace}

Proces kompilace zahrnuje několik charakteristických postupů, které jsou přizpůsobeny optimalizaci výkonu aplikací při vývoji i za běhu. Jejich cílem je zvýšení výkonu a zabezpečení aplikací, ale také zajištění větší kompatibility a efektivity programu napříč platformami. Mezi tyto postupy kompilace patří:

\begin{itemize}
    \item \textbf{Linkování} - Kompilátor během procesu sestavení aplikace propojuje množství zdrojových souborů a dll, aby vytvořily jeden spustitelný soubor nebo knihovnu. To zahrnuje řešení odkazů mezi různými dll a integraci všech požadovaných zdrojů.
    \item \textbf{Optimalizace} - Různé optimalizace IL a nativního kódu pro zlepšení výkonu. Tyto optimalizace probíhají jak během kompilace IL, tak během kompilace JIT nebo AOT do nativního kódu.
    \item \textbf{Tree shaking a trimming} - V moderních aplikacích .NET odstraňují nástroje, jako je IL Linker, během procesu sestavování nepoužívaný kód z konečné sestavy. Toto "protřepávání stromu" snižuje velikost aplikace tím, že vylučuje nepotřebné knihovny a cesty ke kódu.
    \item \textbf{Vytváření metadat a manifestů} - Překladače .NET také vytvářejí metadata a soubory manifestů, které popisují obsah a závislosti sestav, což má zásadní význam pro verzování, zabezpečení a rozlišení sestav za běhu.
\end{itemize}

\n{3}{Kompilace pro CLR}

Standartním výstupem sestavení aplikace v .NETu je transformace zdrojového kódu z vybraného podporovaného jazyka do assembly v jazyce IL. Tento výstupní IL se v .NET konkrétně navývaná Common Intermediate language (CIL) nebo také Microsoft Intermediate Language (MSIL). IL je jazyk nezávislý na platformě, který je následně kompilován do nativního kódu za běhu aplikace.

CLR je zodpovědný za interpretaci IL kódu a jeho kompilaci do nativního kódu. Kompilace do nativního kódu je prováděna v rámci běhu aplikace, což zajišťuje, že kód je optimalizován pro konkrétní architekturu systému. V případě jazyka C\# na platformě Windows slouží ke kompilaci spustitelný soubor \emph{csc.exe}. 

Výstupem kompilace pro CLR je assembly s popisnými metadaty a IL (v případě režimu R2R i částečně nativním) kódem. Assembly typicky disponují příponou \emph{.dll}, případně jsou zabaleny do spustilného souboru dle cílové platformy a výstupu. Takovýto výstup je následně připraven buďto ke spuštění za pomocí CLR, případně pro využití a referenci při tvorbě dalšího .NET kódu. Kód IL je sada instrukcí nezávislá na procesoru, kterou může spustit běhové prostředí .NET (CLR).

Speciálním případe JIT kompilace je aplikace R2R. Zdrojový kód je při sestavení zkompilován do podoby nativního kódu pomocí nástroje crossgen, čímž vzniknou sestavy R2R. Za běhu se sestavy R2R načtou a spustí s minimální kompilací JIT, protože většina kódu je již v nativní podobě. CLR může přesto JIT kompilovat některé části kódu, které nelze staticky zkompilovat předem. Využití je v aplikacích, které potřebují zkrátit dobu spouštění, ale zachovat určitou funkcionalitu nebo úroveň optimalizace poskytovanou JIT kompilací.

\n{3}{Kompilace do nativního kódu}

Přímá nativní AoT kompilace je proces, při kterém je kód kompilován do podoby sytémově nativního kódu při sestavení programu ze zdrojového kódu. V případě .NETu je tato funkcionalita dostupná při použití jazyka C\# a speciálních projektových atributů. 

Jedná se o funkcionalitu, jenž prošla několika iteracemi. První možnosti sestavení aplikace v nativním kódu na .NET platformě byly aplikace Universal Windows Platform. Jednalo se o aplikace využívající specifické rozhraní, nativní pro produkty Microsoftu. S verzí .NET framework 7 byly rozšířeny možnosti sestavení aplikace jako do podoby nativního kódu i pro další architektury a typy aplikací. Tato nová funkcionalita získala vyráznější podporu v roce 2023 s vydáním dotent framework 8. Filozofie Microsoftu ohledně AoT kompilace je, že vývojáři by měli mít možnost využít AOT kompilace v .NETu, pokud je to pro daný scénář vhodné. Scénáře kladoucí takovéto požadavky se vyskytují především v cloudovém nasazení, na které v současné filosofii apelují. 

Výstupem nativní AoT kompilace .NET aplikace je spustitelný soubor ve formátu podporovaném operačním systémem konfigurovaným v procesu kompilace. Takto vytvořený soubor je možné spustit přímo bez potřeby CLR. 

\n{2}{Běh kódu}

Spuštění, respektive běh kódu na HW počítačového zařízení vyžaduje instrukční sadu, které daná architektura rozumí, tedy nativní kód. V případě nativní AoT kompilace v .NET tento kód získáme již při sestavení aplikace. Při využití kompilace do IL je nutné kód získat pomocí jednoho z kompilačních způsobů podporovaného CLR. Výsledná nativní reprezentace se v obou případech spouští zavoláním vstupní metody v binárním souboru dle specifikace architektury.

\n{3}{CLR}

Common Language Runtime (CLR) je běhové prostředí frameworku .NET. Poskytuje spravované prostředí pro spouštění aplikací .NET. Podporuje více programovacích jazyků, včetně jazyků C\#, VB.NET a F\#, a umožňuje jejich bezproblémovou spolupráci. Spravuje paměť prostřednictvím automatického garbage collection, který pomáhá předcházet únikům paměti a optimalizuje využití prostředků. CLR také zajišťuje typovou bezpečnost a ověřuje, zda jsou všechny operace typově bezpečné, aby se minimalizovaly chyby při programování.

CLR je zodpovědný za několik důležitých funkcí, které zvyšují produktivitu vývojářů a výkon aplikací.

\begin{itemize}
    \item \textbf{Správa paměti} - CLR spravuje alokaci a dealokalizaci paměti, čímž zajišťuje efektivní využití systémových prostředků a zabraňuje memory leaks (únikům paměti). Obsahuje garbage collector (GC), který automaticky přiděluje a sbírá paměť obsazenou objekty.
    \item \textbf{Bezpečnost} - CLR poskytuje komplexní model zabezpečení, který pomáhá chránit aplikace před neoprávněným přístupem, poškozením dat a dalšími bezpečnostními hrozbami. Vynucuje zásady zabezpečení, jako je zabezpečení přístupu ke kódu (CAS) a zabezpečení založené na rolích. Zajišťuje, aby kód byl spouštěn s příslušnými oprávněními na základě svého původu a úrovně důvěryhodnosti, čímž chrání citlivá data a systémové prostředky.
    \item \textbf{Zpracování vyjímek} - Zpracování výjimek v CLR zahrnuje detekci, propagaci a zpracování chyb a stavů, které mohou nastat během provádění programu. Mechanismus vyjímek umožňuje elegantně řešit neočekávané situace a zachovat stabilitu aplikace.
    \item \textbf{Generování typů} - CLR podporuje dynamické generování typů za běhu, což aplikacím umožňuje za běhu dynamicky vytvářet a manipulovat typy dle potřeby. To dává možnost scénářům, jako je dynamické generování kódu, kompilace kódu za běhu a dynamické vytváření objektů.
    \item \textbf{Reflexe} - Reflexe umožňuje validaci a manipulaci typů, attributů a metadat načtených z dll za běhu. Umožňuje vývojářům dotazovat se a upravovat typy a jejich attributy za běhu, dynamicky volat metody a přistupovat k informacím o metadatech. Díky tomu mají aplikace .NET využívající běhové prostředí výrazné možnosti introspekce a přizpůsobení.
\end{itemize}

Klíčovými vlasnostmi jsou CLR jsou multiplatformnost kódu, reflexe, optimalizace kódu pro konkrétní architekturu a bezpečnost. CLR nabízí mechanismy, jako je zabezpečení přístupu ke kódu (CAS), které zabraňují neoprávněným operacím. Kompilace JIT (just-in-time) znamená, že kód zprostředkujícího jazyka je zkompilován do nativního kódu těsně před spuštěním, což zajišťuje optimální výkon na cílovém hardwaru. CLR usnadňuje zpracování chyb v různých jazycích a poskytuje konzistentní přístup k řešení výjimek. Navíc obsahuje nástroje pro ladění a profilování, které vývojářům pomáhají efektivně identifikovat a odstraňovat problémy s výkonem.

Aby mohl být kód z IL reprezentace spuštěn na systému, respektive HW stroje, musí být dodatečně kompilován. Za tímto účelem existuje v CLR několik technik, které s sebou přínáší různé benefity a negativa a mají využití v specifických scénářích.

\n{3}{Nativní kód}

Běh nativního kódu je závislý na konkrétní architektuře systému, pro které jsou nativní programové soubory vytvořeny. Nepodléhá další úpravě ze strany .NET nástrojů. Spuštění probíhá nativním příkazem operačního systému, který zprostředkuje spuštění programu.

\n{2}{Tvorba programu v dotnet}

Následující část popisuje obecnou koncepci a strukturu projektu aplikace v dotnet. Součástí je postup pro tvorbu a vydání projektu. Blížší pozornost bude věnována tvorbě nativního AoT projektu.

\n{3}{Struktura aplikačních zdrojů}

Základním strukturovaným prvkem v .NET aplikaci je projektový soubor. Jedná se o XML soubor disponující příponou \emph{.csproj}. V rámci něj dochází ke konfiguraci a deklaraci, jak bude .NET CLI s projektem pracovat. Zároveň jsou zde definováný závislosti na další projekty a knihovny. Mezi základní charakteristiky běžně určené v projektovém souboru patří verze .NET, verze projektu/assembly, seznam závislostí, konfigurace pro buildování, testování a publikaci.

Pro tvorbu složitějších aplikací je možné využít více projektových souborů, které jsou následně propojeny. Tento způsob je využíván především v případě větších aplikací, které jsou rozděleny do více částí. Propojení a vazby mezi více projekty v aplikaci je definované pomocí tzv. solution souboru. Jedná se o kontejnerový soubor s příponou \emph{.sln}, jenž popisuje závislosti mezi projektovými soubory, konfigurace sestavení a nasazení a správu pomocných souborů.

\n{3}{Obecný postup}

\begin{enumerate}
    \item \textbf{Nastavení vývojového prostředí}: Sestává z instalace sady nástrojů .NET SDK.
    
    \item \textbf{Vytvoření projektu}: Pomocí příkazu \texttt{dotnet new} nebo skrze GUI IDE je vytvořen nový projekt a solution soubor. Součástí je výběr typu projektu, jazyka, frameworku a dalších konfiguračních parametrů.
    
    \item \textbf{Programování}: Sestává z tvorby kódu aplikace, testování a ladění.

    \item \textbf{Správa závislostí}: Pomocí nástrojů .NET CLI je možno referencovat balíčky a knihovny v rámci projektu.
    
    \item \textbf{Kompilace}: Kompilace aplikace probíhá pomocí příkazu \texttt{dotnet build}, který převede vysokoúrovňový kód do IL. V případě AoT dochází k dodatečné kompilace do nativního kódu dle cílové architektury.
    
    \item \textbf{Publikování}: Použitím příkazu příkazu \texttt{dotnet publish} dochází k vydání aplikace, tedy specifickému sestavení v konfigurovaném nastavení.
\end{enumerate}

\n{3}{Tvorba nativního programu}

Pro tvorbu nativního programu v .NET je nutné využít speciálního atributu \emph{PublishAoT} v projektovém souboru. Tento atribut je zodpovědný za konfiguraci projektu pro nativní AoT kompilaci. Při jeho použití je nutné specifikovat cílovou architekturu, pro kterou je nativní kód vytvářen. Po kompilaci kódu do IL dochází k dodatečné kompilaci do nativního kódu, která dodává další konzolový výstup s informacemi o průběhu kompilace.

Vzhledem k tomu, že nativní AoT kompilace je v .NETu stále vývojově nezralá, samotný proces kompilace, tak jako analýza kompilovaného kódu není dostatečně informativní. Za účelem přenesení vysokoúrovňových konceptů a formálních zápisů v C\# je při kompilace prováděno široké spektrum transformací a gerování kódu.

\begin{itemize}
    \item \textbf{EmitCompilerGeneratedFiles} - Pokud je v projektu nastaven atribut EmitCompilerGeneratedFiles na pravdivou hodnotu, kompilátor generuje soubory, které obsahují podrobné informace o stavu zkompilované aplikace. Ty zahrnují i meziprodukty nebo výpisy strojového kódu, které jsou cenné pro procest ladění a analýzy výstupního produktu. Pomáhají při zacílení na kompilaci do nativního AOT lépe pochopit, jak je vysokoúrovňový kód překládán do strojového kódu.
    \item \textbf{Deklarace unmanaged rozhraní} - Deklarace unmanaged nebo také nespravovaného rozhraní zahrnuje definování způsobů, jakými spravovaný kód spolupracuje s nespravovanými nativními knihovnami nebo systémy. To je zásadní v nativním AOT, protože celá aplikace je kompilována do nativního kódu před spuštěním, takže nezbývá žádný prostor pro úpravy za běhu, které se obvykle provádějí při kompilaci Just-In-Time (JIT). Tyto deklarace specifikují způsob volání unmanaged funkcí, což jsou funkce operující mimo .NET aplikaci, například v C/C++ knihovně.
    U nativních AOT aplikací je důležité, aby tato rozhraní byla přesně definována a dodržována, protože jakýkoli nesoulad nebo chyba v deklaraci může vést k chybám za běhu, které se hůře diagnostikují a opravují kvůli absenci runtime prostředí a dynamickým funkcím.
    \item \textbf{Trimming} - Proces odstraňování nepotřebného kódu a zdrojů z aplikace během sestavení, za účelem snížení velikosti a zvýšení výkonu. V rámci platformy .NET představuje trimming jednu z technik postupu "tree shaking", kdy překladač analyzuje, které části zdrojového kódu jsou skutečně používány, a zbytek vyloučí z výstupního produktu. To je zvláště důležité pro aplikace, kde je úložiště nebo paměť omezená. Ořezávání pomáhá při optimalizaci aplikací a zajišťuje, aby běhové prostředí obsahovalo pouze nezbytné části nutné pro fungování aplikace.
\end{itemize}

\n{3}{Přehled podpory}

Následující přehled představuje rozsah funkcionality implementované v rámci .NET frameworku 8.0, konkrétně APS.NET k datu zvěřejnění práce.

\begin{itemize}
    \item \textbf{REST minimal API}
    \item \textbf{gRPC API}
    \item \textbf{JWT Authentication}
    \item \textbf{CORS}
    \item \textbf{HealthChecks}
    \item \textbf{HttpLogging}
    \item \textbf{Localization}
    \item \textbf{OutputCaching}
    \item \textbf{RateLimiting}
    \item \textbf{RequestDecompression}
    \item \textbf{ResponseCaching}
    \item \textbf{ResponseCompression}
    \item \textbf{Rewrite}
    \item \textbf{StaticFiles}
    \item \textbf{WebSockets}
\end{itemize}
